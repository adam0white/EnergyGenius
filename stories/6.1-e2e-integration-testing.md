# Story 6.1: End-to-End Integration Testing

**Epic:** Epic 6 - Integration & Polish
**Status:** Ready for Development
**Priority:** P0 - Quality Gate
**Complexity:** Medium
**Owner:** Dev Team

---

## User Story

As a QA engineer, I need to execute comprehensive end-to-end testing across all user flows (intake → pipeline → results) with multiple scenario types and edge cases, so that I can verify the application functions correctly before production deployment.

---

## Acceptance Criteria

### Complete Flow Testing

- [ ] Execute intake → loading → results flow for residential scenario
- [ ] Execute intake → loading → results flow for business scenario
- [ ] Execute intake → loading → results flow for seasonal scenario
- [ ] Verify all 3 stages advance in ProgressTimeline (Queued → Running → Complete)
- [ ] Verify RecommendationDeck displays 3 recommendations after loading completes
- [ ] Verify all recommendations have title, description, and savings projection
- [ ] Verify API request payload matches expected schema (usage, type, location, etc.)
- [ ] Verify API response payload parses correctly without errors
- [ ] Verify no console errors during complete flow execution

### Form Validation Testing

- [ ] Test submit with all fields empty: validation errors displayed
- [ ] Test submit with monthly usage = 0: validation error shown
- [ ] Test submit with monthly usage > 50000: validation error shown
- [ ] Test submit with invalid zip code format: validation error shown
- [ ] Test submit with special characters in name: field accepts or rejects consistently
- [ ] Test submit with minimum valid values: form submits successfully
- [ ] Test submit with maximum valid values: form submits successfully
- [ ] Test form field focus and tab order (proper sequence)
- [ ] Test form clears on "Start Over" button click

### Error Scenario Testing

- [ ] Simulate API timeout (>30s): error state displays with retry button
- [ ] Simulate API network error: error message is clear and readable
- [ ] Simulate API 500 error: error displays gracefully without crashing
- [ ] Simulate invalid API response (malformed JSON): error handled
- [ ] Retry button successfully re-submits intake data after error
- [ ] "Start Over" button in error state resets form to intake
- [ ] Error doesn't persist after page refresh
- [ ] Multiple retries work without increasing error count indefinitely

### State Machine Verification

- [ ] Initial state: app loads in intake state
- [ ] Intake → Loading: form submission triggers state transition
- [ ] Loading → Results: all 3 stages complete triggers state transition
- [ ] Results → Intake: "Start Over" button resets to intake state
- [ ] Error → Loading: retry button from error state retriggers API call
- [ ] Error → Intake: optional back button (if present) returns to intake
- [ ] Page refresh returns to intake state (state not persisted to localStorage)

### Browser DevTools Validation

- [ ] Network tab shows POST /api/recommend request
- [ ] Network tab shows 200/400/500 response code (expected based on scenario)
- [ ] Request headers include Content-Type: application/json
- [ ] Response body contains recommendations array with 3+ items
- [ ] No 404 or CORS errors in network tab
- [ ] Console shows no JavaScript errors during flow
- [ ] No performance warnings (e.g., unoptimized images, render warnings)

---

## Implementation Details

### Testing Environment

- Chrome DevTools for network inspection
- iPhone SE (375px) for mobile testing
- iPad Air (768px) for tablet testing
- Desktop (1920px) for desktop testing

### Test Data Scenarios

**Residential:**
- Monthly usage: 800 kWh
- Utility type: Electric
- Location: California
- Expected: cost-focused recommendations

**Business:**
- Monthly usage: 5000 kWh
- Utility type: Electric + Gas
- Location: Texas
- Expected: sustainability-focused recommendations

**Seasonal:**
- Monthly usage: 500 (winter) → 1200 (summer)
- Utility type: Electric
- Location: Arizona
- Expected: seasonal usage pattern recommendations

### Test Execution Steps

1. Open browser to localhost:3000 (or deployed URL)
2. Verify intake form loads and is responsive
3. Enter residential scenario data
4. Click submit and observe timeline progression
5. Wait for results to display
6. Verify recommendation cards render correctly
7. Click "Start Over" and verify form resets
8. Repeat steps 3-7 for business and seasonal scenarios
9. Test error scenarios (timeouts, network errors, validation)
10. Document all results in testing-notes.md

---

## Context References

**Tech-Spec:** Testing Strategy section covers manual QA approach

**PRD:** Non-Functional Requirements section lists:
- Performance target: <20s API response
- All user flows must complete without errors
- Results must be accurate and meaningful

---

## Dev Agent Record

### Status: PENDING DEVELOPMENT

---

## QA Checklist

- [ ] All 3 scenario types tested successfully
- [ ] No console errors during any flow
- [ ] DevTools network inspection shows correct payloads
- [ ] Error scenarios handled gracefully
- [ ] Results documented in testing-notes.md
