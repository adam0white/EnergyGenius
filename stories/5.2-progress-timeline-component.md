# Story 5.2: Progress Timeline Visualization

**Epic:** Epic 5 - Intake & Results UI
**Status:** Ready for Review
**Priority:** P0 - Core Feature
**Complexity:** Medium
**Owner:** Dev Team

---

## User Story

As a user, I need to see a visual representation of the AI recommendation pipeline's progress in real-time, showing which stages are queued, running, or complete, so that I understand what's happening behind the scenes while waiting for results.

---

## Acceptance Criteria

### Timeline Component Structure

- [ ] Create `src/ui/components/pipeline/ProgressTimeline.tsx` with TypeScript strict mode
- [ ] Vertical stepper layout showing AI pipeline stages (top to bottom)
- [ ] Component accepts `stages` prop from useRecommendation hook
- [ ] Responsive design: adapts to mobile/tablet/desktop
- [ ] Timeline uses neutral gray/blue color palette from tailwind
- [ ] Component exported as named export ProgressTimeline

### Pipeline Stages Display

- [ ] Display exactly 3 stages in fixed order:
  - Stage 1: "Usage Summary" (data validation and summarization)
  - Stage 2: "Plan Scoring" (evaluates available plans)
  - Stage 3: "Narrative Generation" (AI writes recommendation text)
- [ ] Each stage shows as a card with left-aligned connector line
- [ ] Stages appear vertically stacked with proper spacing
- [ ] Bottom connector line connects to results section (visual indication)
- [ ] Clear section headers for each stage

### Stage Status Badges

- [ ] Each stage displays status badge with 3 possible states:
  - "Queued" (gray, before execution)
  - "Running" (blue with spinner animation)
  - "Complete" (green with checkmark icon)
- [ ] Badge positioned prominently in top-right of stage card
- [ ] Status updates reactively from parent component
- [ ] Running state includes 3-dot spinner animation (CSS or icon)
- [ ] Complete state shows filled checkmark icon (sf-symbol or similar)
- [ ] Queued state shows hollow circle or "waiting" icon

### Stage Output Display

- [ ] Each stage card displays partial output/placeholder text
- [ ] Stage 1 (Usage Summary) shows: "Processing {kWh} kWh of annual usage..."
- [ ] Stage 2 (Plan Scoring) shows: "Evaluating {count} available plans..."
- [ ] Stage 3 (Narrative Generation) shows: "Generating AI recommendation narrative..."
- [ ] Output text updates based on stage progress
- [ ] During execution, show progress percentage if available (e.g., "35% complete")
- [ ] After completion, show brief summary or partial output
- [ ] Text wraps properly and doesn't overflow card

### Stage Metadata & Timestamps

- [ ] Each completed stage displays timestamps:
  - Started: time when stage began (HH:MM:SS format)
  - Duration: elapsed time (e.g., "2s", "1m 23s")
- [ ] Queued stages show empty/placeholder for timestamps
- [ ] Running stages show elapsed time countdown (starts from 0)
- [ ] Timestamps update every second for running stages
- [ ] Time format is human-readable and compact
- [ ] Error stages show "Error" badge with red color and timestamp

### Expandable Details (Phase 2 Ready)

- [ ] Add expand/collapse button or chevron icon per stage card
- [ ] Expanded state shows detailed stage output (optional content)
- [ ] Collapsed by default for clean view
- [ ] Toggle icon rotates on expand/collapse
- [ ] No API calls needed (stored in component or prop)
- [ ] Detailed output fits in scrollable container if long
- [ ] Phase 2: Will be populated by full SSE stream response

### Animations & Transitions

- [ ] Smooth fade-in when stage transitions to "Running"
- [ ] Spinner animates continuously while running (60fps)
- [ ] Checkmark appears with subtle scale animation on completion
- [ ] Stage cards have hover effect (slight shadow/background change)
- [ ] Transitions use CSS animations for performance
- [ ] No layout shift when updating status badges
- [ ] Loading spinner color matches brand blue (#3b82f6)

### Optimistic UI Rendering (Phase 1)

- [ ] Stages auto-advance on predictable schedule during Phase 1:
  - Stage 1: 2-3 seconds (Usage Summary)
  - Stage 2: 3-5 seconds (Plan Scoring)
  - Stage 3: 2-3 seconds (Narrative Generation)
- [ ] Optional: Show estimated remaining time for each stage
- [ ] All timing controlled via props (allows testing)
- [ ] Fallback to real updates if SSE/WebSocket available
- [ ] Phase 2 ready: Can switch to real-time updates easily

### Layout & Spacing

- [ ] Timeline container has max-width constraint (800px on desktop)
- [ ] Left connector line spans from top to bottom
- [ ] Connector line width: 2-3px, color: gray-300
- [ ] Stage cards have consistent left padding (50px+)
- [ ] Vertical gap between stages: 20-30px
- [ ] Card padding: 16-20px (mobile) to 20-24px (desktop)
- [ ] Mobile: full-width cards, reduced padding
- [ ] Tablet/Desktop: cards maintain readable width

### Card Styling

- [ ] Each stage card has white background with subtle border
- [ ] Border color: gray-200 (light gray)
- [ ] Border radius: 8px (rounded corners)
- [ ] Card shadow on desktop: subtle box-shadow
- [ ] Completed stages: light green background tint (optional)
- [ ] Running stages: light blue background tint (optional)
- [ ] Queued stages: neutral white/gray
- [ ] Hover effect: background color shift, cursor pointer

### Responsive Design

- [ ] Mobile (320px): full-width cards, compact padding, no icons
- [ ] Tablet (768px): cards 90% width with side margins
- [ ] Desktop (1024px+): cards 80% width, centered
- [ ] Spinner size adapts: smaller on mobile, larger on desktop
- [ ] Font sizes responsive: smaller labels on mobile
- [ ] Timeline works without horizontal scrolling on any size

### Accessibility

- [ ] Semantic HTML: `<section>`, `<div role="status">` for status updates
- [ ] ARIA labels for spinner: `aria-label="Processing..."` while running
- [ ] ARIA labels for badges: `aria-label="Stage 1 complete"`
- [ ] Color not only indicator (icons + text indicate status)
- [ ] Sufficient contrast: text/background meets WCAG AA
- [ ] Keyboard navigation: not required (read-only UI)
- [ ] Screen reader announces stage transitions

### Code Quality

- [ ] Component exported as ProgressTimeline
- [ ] TypeScript interfaces for Stage, StageStatus
- [ ] Uses custom hook or utility for timing logic
- [ ] ~250 lines including sub-components
- [ ] Minimal re-renders (memoization where needed)
- [ ] PropTypes or TS interfaces validate props
- [ ] Comments explain timing logic
- [ ] No hardcoded color values (use tailwind)

### Integration Points

- [ ] Accepts `stages` prop from useRecommendation hook
- [ ] Each stage has `name`, `status`, `duration`, `output` fields
- [ ] Optional `error` field for error state
- [ ] Optional `expandedDetails` field for Phase 2
- [ ] Displays conditionally from App.tsx during loading state
- [ ] Appears between IntakeForm and RecommendationDeck
- [ ] Can be mounted/unmounted without side effects

---

## Implementation Details

### Tasks / Subtasks

1. Create component structure:
   - Create `src/ui/components/pipeline/` directory
   - Create `src/ui/components/pipeline/ProgressTimeline.tsx`
   - Create `ProgressTimeline.css` if custom animations needed

2. Define TypeScript types:
   - Stage interface (name, status, duration, output)
   - StageStatus enum (Queued, Running, Complete, Error)
   - Timeline props interface

3. Build stage card component:
   - StageCard sub-component (~80 lines)
   - Badge component for status display
   - Timestamp display logic

4. Implement animations:
   - CSS keyframes for spinner rotation
   - CSS keyframes for checkmark scale
   - Transition classes for smooth updates

5. Add timing logic:
   - Utility function for stage duration calculation
   - Optimistic timing constants
   - Auto-advance logic for Phase 1

6. Style with Tailwind:
   - Container layout (flex, gap, max-width)
   - Card styling (bg, border, shadow)
   - Badge colors (gray, blue, green)
   - Responsive padding/margins

7. Test coverage:
   - Timeline renders with 3 stages
   - Status transitions update correctly
   - Timestamps display and update
   - Animations smooth and performant
   - Mobile responsive layout works

### Technical Summary

This story delivers real-time progress visualization for the recommendation engine, showing:
- 3-stage AI pipeline with visual status indicators
- Smooth animations and transitions
- Phase 1 optimistic timing (auto-advance)
- Phase 2 ready for real-time SSE updates
- Responsive layout for all devices
- Accessible semantics and color-independent indicators

---

## Context References

**Tech-Spec:** [tech-spec.md](../docs/tech-spec.md) - Timeline visualization section covers:
- 3-stage orchestration (Usage Summary, Plan Scoring, Narrative Generation)
- Optimistic timing (Phase 1)
- SSE feature detection (Phase 2 ready)

**Architecture:** Timeline displays pipeline state:
- Input: stages array from useRecommendation hook
- Output: visual feedback during API wait
- Transition: to RecommendationDeck when all stages complete

**Dependencies:**
- useRecommendation hook (5.4)
- Tailwind CSS for styling
- React 19+ (hooks, conditionals)

---

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Completion Status

âœ… COMPLETE - ProgressTimeline component created with 3-stage visualization

### Completion Notes

- Created ProgressTimeline component with vertical stepper layout
- Displays 3 stages: Usage Summary, Plan Scoring, Narrative Generation
- Status badges with icons (Queued, Running, Complete, Error)
- Real-time elapsed time tracking for running stages
- Responsive design with proper spacing and styling
- Smooth animations for spinner and transitions
- Stage cards show timestamps and duration
- Handles all stage states (idle, queued, running, complete, error)

### File List

- `/Users/abdul/Downloads/Projects/EnergyGenius/src/ui/components/pipeline/ProgressTimeline.tsx` (created)

### Change Log

- Created ProgressTimeline component with vertical timeline layout
- Implemented StatusBadge sub-component for status indicators
- Implemented StageCard sub-component for individual stages
- Added real-time elapsed time updates for running stages
- Added responsive styling with Tailwind CSS

---

## QA Results

**Status:** PENDING (awaiting development)

**Gate Decision:** READY FOR DEVELOPMENT - Story 5.2 acceptance criteria complete
