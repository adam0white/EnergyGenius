# Story 7.11: Fix Error Message Visibility

**Epic:** Epic 7 - Post-Launch Improvements
**Status:** Ready for Development
**Priority:** P2 - Medium
**Complexity:** Low
**Owner:** Dev Team

---

## User Story

As a user, when I click "Get Recommendations" with missing data, the error message should be visible without having to scroll up. Currently, the error appears at the top of the page, which is not visible when the form is at the bottom.

---

## Acceptance Criteria

### 1. Investigate Current Error Handling

- [ ] Reproduce the issue:
  - [ ] Load the application
  - [ ] Scroll to the bottom of the page to the "Get Recommendations" button
  - [ ] Try submitting form with missing required fields
  - [ ] Observe error message behavior
  - [ ] Document: Does error appear at top? Do you need to scroll to see it?

- [ ] Find error handling code:
  - [ ] Where are validation errors shown? (likely React component state or toast notifications)
  - [ ] Where is the error message rendered?
  - [ ] How is error visibility controlled?
  - [ ] File locations: Look in form components, handlers, UI components

- [ ] Document current behavior:
  - [ ] Where does error appear on page?
  - [ ] Does user see it from current scroll position?
  - [ ] When does error disappear? (always visible, timeout, click dismiss?)
  - [ ] What fields trigger validation errors?

- [ ] Identify root cause:
  - [ ] Error rendered at top of page (poor UX)
  - [ ] Page doesn't auto-scroll to error
  - [ ] Error hidden by other UI elements
  - [ ] Error placed far from submit button

- [ ] Developer has full authority to investigate and modify error display

### 2. Choose Error Display Solution

**Option A: Auto-Scroll to Error (Recommended)**
- [ ] When validation error occurs:
  - [ ] Scroll page to top where error is displayed
  - [ ] Smooth scroll: `behavior: 'smooth'`
  - [ ] User sees error immediately
  - [ ] Clear what's wrong

- [ ] Implementation:
  ```typescript
  // When error occurs
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
  ```

**Option B: Error Toast Near Submit Button**
- [ ] Show error as toast notification:
  - [ ] Toast appears at bottom of screen (where button is)
  - [ ] Floats above submit button or near it
  - [ ] User sees it immediately without scrolling
  - [ ] Implementation uses Sonner or similar toast library

- [ ] Implementation:
  ```typescript
  // When validation fails
  toast.error("Please fill in all required fields");
  ```

**Option C: Inline Errors Near Fields**
- [ ] Show errors near invalid fields:
  - [ ] Red text below each empty/invalid field
  - [ ] Field highlights in red
  - [ ] User sees what's wrong where it is
  - [ ] All validation feedback visible at once

- [ ] Implementation:
  ```tsx
  {errors.name && (
    <p className="text-red-600 text-sm">{errors.name}</p>
  )}
  ```

**Option D: Error Modal/Alert**
- [ ] Show errors in a modal dialog:
  - [ ] Modal appears on top of everything
  - [ ] Clear, visible error message
  - [ ] User must close to continue
  - [ ] Can't miss the error

- [ ] Implementation:
  ```tsx
  <AlertDialog open={hasErrors}>
    <AlertDialogContent>
      <AlertDialogTitle>Validation Error</AlertDialogTitle>
      <p>{errorMessage}</p>
    </AlertDialogContent>
  </AlertDialog>
  ```

**Recommendation:** Combine B (toast for quick feedback) + C (inline errors for field-level feedback)

### 3. Improve Current Error Display

- [ ] If using top-of-page errors, add auto-scroll:
  - [ ] Keep error at top location
  - [ ] But scroll to it automatically when error occurs
  - [ ] Use `window.scrollTo()` or `element.scrollIntoView()`
  - [ ] Add smooth animation

- [ ] Make error message more visible:
  - [ ] Use bold font weight
  - [ ] Use larger font size
  - [ ] Use clear warning icon
  - [ ] Use contrasting red color
  - [ ] Add padding/margin for emphasis

- [ ] Add error timeout:
  - [ ] Don't let error disappear automatically (user needs to see it)
  - [ ] User must dismiss or fix issue
  - [ ] Or: dismiss after 5+ seconds if they scroll away

### 4. Add Inline Field Validation

- [ ] Show errors next to problematic fields:
  - [ ] Empty required fields: "This field is required"
  - [ ] Invalid values: "Please enter a valid value"
  - [ ] Red border or text under field
  - [ ] Clear what needs to be fixed

- [ ] Implement in form component:
  - [ ] Track validation state for each field
  - [ ] Show error message if field is invalid
  - [ ] Clear error when field is corrected
  - [ ] Disable submit button if validation fails (optional but helpful)

- [ ] Example:
  ```tsx
  <div className="mb-4">
    <input
      name="budget"
      className={`border ${errors.budget ? 'border-red-500' : 'border-gray-300'}`}
      onChange={handleChange}
    />
    {errors.budget && (
      <p className="text-red-600 text-sm mt-1">{errors.budget}</p>
    )}
  </div>
  ```

### 5. Add Submit Button Feedback

- [ ] Disable submit while form is submitting:
  - [ ] Button shows loading state
  - [ ] Prevents duplicate submissions
  - [ ] Shows user it's processing

- [ ] Show success state briefly:
  - [ ] After submission succeeds
  - [ ] Show checkmark icon
  - [ ] Navigate to results or show confirmation

- [ ] Provide feedback for validation failures:
  - [ ] Button briefly shows error state
  - [ ] Visual feedback that something is wrong
  - [ ] User understands why submit failed

### 6. Test Error Scenarios

- [ ] Test all missing field combinations:
  - [ ] All fields missing
  - [ ] Individual fields missing
  - [ ] Some fields filled, some missing
  - [ ] Verify error message for each scenario

- [ ] Test error visibility:
  - [ ] Scroll to bottom
  - [ ] Submit with missing fields
  - [ ] Verify error is visible without scrolling
  - [ ] Or auto-scroll happens
  - [ ] Test on mobile (small viewport)

- [ ] Test error dismissal:
  - [ ] How does user clear error?
  - [ ] Can they fix field and try again?
  - [ ] Does error clear when field is corrected?
  - [ ] Test error timeout (if implemented)

- [ ] Test on different devices:
  - [ ] Desktop (large viewport)
  - [ ] Tablet (medium viewport)
  - [ ] Mobile (small viewport)
  - [ ] Verify error visibility on all sizes

- [ ] Test accessibility:
  - [ ] Error message is announced to screen readers
  - [ ] Field errors associated with inputs
  - [ ] Focus moves to first invalid field (optional)
  - [ ] Color not sole indicator of error (also use text)

### 7. Documentation

- [ ] Update help text:
  - [ ] Add validation help to form fields
  - [ ] Explain which fields are required
  - [ ] Explain valid values for each field
  - [ ] Add tooltips or help icons

- [ ] Update user-facing docs:
  - [ ] Document how to use the form
  - [ ] Explain validation errors
  - [ ] Add screenshots showing proper form fill

- [ ] Add developer documentation:
  - [ ] Update code with comments
  - [ ] Document validation logic
  - [ ] Document error handling approach
  - [ ] Add to `/docs/development.md` if complex

- [ ] Commit message: "Improve error message visibility - Auto-scroll and inline validation errors"

## Tasks / Subtasks

- [ ] Investigate Issue (AC: Investigate Current Error Handling)
  - [ ] Reproduce the problem
  - [ ] Find error handling code
  - [ ] Document current behavior
  - [ ] Identify root cause

- [ ] Choose Solution (AC: Choose Error Display Solution)
  - [ ] Evaluate each option
  - [ ] Pick best approach
  - [ ] Consider user experience
  - [ ] Document decision

- [ ] Improve Display (AC: Improve Current Error Display)
  - [ ] Add auto-scroll if needed
  - [ ] Make error message more visible
  - [ ] Add appropriate styling
  - [ ] Test changes

- [ ] Add Inline Validation (AC: Add Inline Field Validation)
  - [ ] Show errors next to fields
  - [ ] Update form component
  - [ ] Add error messages
  - [ ] Test validation

- [ ] Button Feedback (AC: Add Submit Button Feedback)
  - [ ] Add loading state
  - [ ] Add success feedback
  - [ ] Add error feedback
  - [ ] Test all states

- [ ] Test Scenarios (AC: Test Error Scenarios)
  - [ ] Test all error combinations
  - [ ] Test visibility from bottom
  - [ ] Test on different viewports
  - [ ] Test accessibility

- [ ] Document (AC: Documentation)
  - [ ] Update help text
  - [ ] Update user docs
  - [ ] Add code comments
  - [ ] Commit changes

## Dev Notes

### Investigation Authority

Developer has full authority to:
- Modify error display approach
- Change form validation
- Implement auto-scroll or other solutions
- Refactor form components
- Add toast notifications or modals
- Change styling and visibility

### Key Files to Find

**Form/Validation Files:**
- Main form component (likely in `/src/ui/pages/` or `/src/ui/components/`)
- Validation logic (might be in same component or separate file)
- Form handler (handles submission)

**Error Display Files:**
- Where errors are rendered (likely in form component)
- Any error component (might be separate)
- Toast notification system (if used)
- Alert/Modal components

### Auto-Scroll Implementation

```typescript
// Scroll to top of page smoothly
const handleValidationError = () => {
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
};

// Or scroll to specific element
const scrollToError = (selector: string) => {
  const element = document.querySelector(selector);
  if (element) {
    element.scrollIntoView({
      behavior: 'smooth',
      block: 'start'
    });
  }
};
```

### Toast Notification Example

If using Sonner or similar:
```typescript
import { toast } from 'sonner';

// In validation handler
if (!isValid) {
  toast.error("Please fill in all required fields");
  return;
}
```

### Inline Error Example

```tsx
<form onSubmit={handleSubmit}>
  <div className="mb-4">
    <label htmlFor="budget">Monthly Budget (USD)</label>
    <input
      id="budget"
      name="budget"
      type="number"
      value={budget}
      onChange={handleChange}
      className={`
        w-full px-3 py-2 border rounded
        ${errors.budget ? 'border-red-500 bg-red-50' : 'border-gray-300'}
      `}
      aria-invalid={!!errors.budget}
      aria-describedby={errors.budget ? 'budget-error' : undefined}
    />
    {errors.budget && (
      <p id="budget-error" className="text-red-600 text-sm mt-1">
        {errors.budget}
      </p>
    )}
  </div>

  {/* Other fields */}

  <button type="submit" disabled={isSubmitting}>
    {isSubmitting ? 'Submitting...' : 'Get Recommendations'}
  </button>
</form>
```

### Testing Error Display

```typescript
// Test that error is visible from bottom of form
test('shows error when submitting empty form', async () => {
  render(<RecommendationForm />);

  // Scroll to bottom
  window.scrollY = document.body.scrollHeight;

  // Submit empty form
  const submitButton = screen.getByText('Get Recommendations');
  fireEvent.click(submitButton);

  // Check if error is visible (within viewport or scrolled into view)
  const error = screen.getByText('Please fill in all required fields');
  expect(error).toBeVisible();
});
```

### Common UX Patterns

1. **Gmail-style**: Error toast at top, auto-dismisses
2. **Form fields**: Inline error under field (best for accessibility)
3. **Alert box**: Error banner at top of form (prominent)
4. **Modal**: Error dialog (forces acknowledgment)
5. **Combination**: Inline + toast + button feedback (comprehensive)

## Dev Agent Record

### Context Reference

<!-- Story context XML will be added here by context workflow -->

### Agent Model Used

Claude Sonnet 4.5

### Debug Log References

### Completion Notes List

<!-- To be filled in during development -->

## QA Checklist

- [ ] Error message is visible when form is at bottom
- [ ] Auto-scroll works (if implemented) or error is near button
- [ ] Error message is clear and explains what's wrong
- [ ] Inline field errors show for each invalid field
- [ ] Submit button feedback works (loading/disabled state)
- [ ] Error clears when field is corrected
- [ ] Works on all viewport sizes (mobile, tablet, desktop)
- [ ] Accessible (screen reader announces errors)
- [ ] No console errors
- [ ] All validation scenarios tested
- [ ] Documentation updated
- [ ] Changes committed
